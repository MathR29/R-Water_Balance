}
}
return(x)
}
test <-bh_2024_2025 %>%
select(date,tmax,tmin) %>%
corn_degree_day(emerg_day = "2024-10-01",2400)
corn_degree_day <- function(x,max_gd,emerg_day){
for(i in 1:nrow(x)){
if(x$date[i] < as.Date(emerg_day)){
x$degree_day[i] <- 0.00
}else{
if(x$degree_day[i-1] < max_gd ){
x$degree_day[i] <- round((x$degree_day[i-1] + (((temp_corn(x$tmax[i]) + temp_corn(x$tmin[i]))/2) - 10)),2)
}else{
break
}
}
}
return(x)
}
test <-bh_2024_2025 %>%
select(date,tmax,tmin) %>%
corn_degree_day(emerg_day = "2024-10-01",2400)
corn_degree_day <- function(x,max_gd,emerg_day){
for(i in 1:nrow(x)){
if(x$date[i] < as.Date(emerg_day)){
x$degree_day[i] <- as.numeric(0.00)
}else{
if(x$degree_day[i-1] < max_gd ){
x$degree_day[i] <- round((x$degree_day[i-1] + (((temp_corn(x$tmax[i]) + temp_corn(x$tmin[i]))/2) - 10)),2)
}else{
break
}
}
}
return(x)
}
test <-bh_2024_2025 %>%
select(date,tmax,tmin) %>%
corn_degree_day(emerg_day = "2024-10-01",2400)
corn_degree_day <- function(x,max_gd,emerg_day){
x$dregree_day <- NA
for(i in 1:nrow(x)){
if(x$date[i] < as.Date(emerg_day)){
x$degree_day[i] <- as.numeric(0.00)
}else{
if(x$degree_day[i-1] < max_gd ){
x$degree_day[i] <- round((x$degree_day[i-1] + (((temp_corn(x$tmax[i]) + temp_corn(x$tmin[i]))/2) - 10)),2)
}else{
break
}
}
}
return(x)
}
test <-bh_2024_2025 %>%
select(date,tmax,tmin) %>%
corn_degree_day(emerg_day = "2024-10-01",2400)
View(test)
library(dplyr)
corn_degree_day <- function(x,max_gd,emerg_day){
for(i in 1:nrow(x)){
if(x$date[i] < as.Date(emerg_day)){
x$degree_day[i] <- as.numeric(0.00)
}else{
if(x$degree_day[i-1] < max_gd ){
x$degree_day[i] <- round((x$degree_day[i-1] + (((temp_corn(x$tmax[i]) + temp_corn(x$tmin[i]))/2) - 10)),2)
}else{
break
}
}
}
x %>% mutate(stage = case_when(degree_day < 100 ~ "-",
degree_day < 346 ~ "VE",
degree_day < 592 ~ "V3",
degree_day < 838 ~ "V6",
degree_day < 1020 ~ "V9",
degree_day < 1170 ~ "V12",
degree_day < 1370 ~ "V15",
degree_day < 1420 ~ "V19",
degree_day < 1686 ~ "VT",
degree_day < 1830 ~ "R2",
degree_day < 1981 ~ "R3",
degree_day < 2324 ~ "R4",
degree_day < 2650 ~ "R5",
TRUE ~ "R6"))
return(x)
}
corn_degree_day <- function(x,max_gd,emerg_day){
for(i in 1:nrow(x)){
if(x$date[i] < as.Date(emerg_day)){
x$degree_day[i] <- as.numeric(0.00)
}else{
if(x$degree_day[i-1] < max_gd ){
x$degree_day[i] <- round((x$degree_day[i-1] + (((temp_corn(x$tmax[i]) + temp_corn(x$tmin[i]))/2) - 10)),2)
}else{
break
}
}
}
x %>% mutate(stage = case_when(degree_day < 100 ~ "-",
degree_day < 346 ~ "VE",
degree_day < 592 ~ "V3",
degree_day < 838 ~ "V6",
degree_day < 1020 ~ "V9",
degree_day < 1170 ~ "V12",
degree_day < 1370 ~ "V15",
degree_day < 1420 ~ "V19",
degree_day < 1686 ~ "VT",
degree_day < 1830 ~ "R2",
degree_day < 1981 ~ "R3",
degree_day < 2324 ~ "R4",
degree_day < 2650 ~ "R5",
TRUE ~ "R6"))
return(x)
}
test <-bh_2024_2025 %>%
select(date,tmax,tmin) %>%
corn_degree_day(emerg_day = "2024-10-01",2650)
View(test)
corn_degree_day <- function(x,max_gd,emerg_day){
for(i in 1:nrow(x)){
if(x$date[i] < as.Date(emerg_day)){
x$degree_day[i] <- as.numeric(0.00)
}else{
if(x$degree_day[i-1] < max_gd ){
x$degree_day[i] <- round((x$degree_day[i-1] + (((temp_corn(x$tmax[i]) + temp_corn(x$tmin[i]))/2) - 10)),2)
}else{
break
}
}
}
x <- x %>% mutate(stage = case_when(degree_day < 100 ~ "-",
degree_day < 346 ~ "VE",
degree_day < 592 ~ "V3",
degree_day < 838 ~ "V6",
degree_day < 1020 ~ "V9",
degree_day < 1170 ~ "V12",
degree_day < 1370 ~ "V15",
degree_day < 1420 ~ "V19",
degree_day < 1686 ~ "VT",
degree_day < 1830 ~ "R2",
degree_day < 1981 ~ "R3",
degree_day < 2324 ~ "R4",
degree_day < 2650 ~ "R5",
TRUE ~ "R6"))
return(x)
}
test <-bh_2024_2025 %>%
select(date,tmax,tmin) %>%
corn_degree_day(emerg_day = "2024-10-01",2650)
View(test)
corn_degree_day <- function(x,max_gd,planting_date){
for(i in 1:nrow(x)){
if(x$date[i] < as.Date(emerg_day)){
x$degree_day[i] <- as.numeric(0.00)
}else{
if(x$degree_day[i-1] < max_gd ){
x$degree_day[i] <- round((x$degree_day[i-1] + (((temp_corn(x$tmax[i]) + temp_corn(x$tmin[i]))/2) - 10)),2)
}else{
break
}
}
}
x <- x %>% mutate(stage = case_when(degree_day < 100 ~ "-",
degree_day < 346 ~ "VE",
degree_day < 592 ~ "V3",
degree_day < 838 ~ "V6",
degree_day < 1020 ~ "V9",
degree_day < 1170 ~ "V12",
degree_day < 1370 ~ "V15",
degree_day < 1420 ~ "V19",
degree_day < 1686 ~ "VT",
degree_day < 1830 ~ "R2",
degree_day < 1981 ~ "R3",
degree_day < 2324 ~ "R4",
degree_day < 2650 ~ "R5",
TRUE ~ "R6"))
return(x)
}
test <-bh_2024_2025 %>%
select(date,tmax,tmin) %>%
corn_degree_day(planting_date = "2024-10-01",2650)
corn_degree_day <- function(x,max_gd,planting_date){
for(i in 1:nrow(x)){
if(x$date[i] < as.Date(emerg_day)){
x$degree_day[i] <- as.numeric(0.00)
}else{
if(x$degree_day[i-1] < max_gd ){
x$degree_day[i] <- round((x$degree_day[i-1] + (((temp_corn(x$tmax[i]) + temp_corn(x$tmin[i]))/2) - 10)),2)
}else{
break
}
}
}
x <- x %>% mutate(stage = case_when(degree_day < 100 ~ "-",
degree_day < 346 ~ "VE",
degree_day < 592 ~ "V3",
degree_day < 838 ~ "V6",
degree_day < 1020 ~ "V9",
degree_day < 1170 ~ "V12",
degree_day < 1370 ~ "V15",
degree_day < 1420 ~ "V19",
degree_day < 1686 ~ "VT",
degree_day < 1830 ~ "R2",
degree_day < 1981 ~ "R3",
degree_day < 2324 ~ "R4",
degree_day < 2650 ~ "R5",
TRUE ~ "R6"))
return(x)
}
corn_degree_day <- function(x,max_gd,planting_date){
for(i in 1:nrow(x)){
if(x$date[i] < as.Date(planting_date)){
x$degree_day[i] <- as.numeric(0.00)
}else{
if(x$degree_day[i-1] < max_gd ){
x$degree_day[i] <- round((x$degree_day[i-1] + (((temp_corn(x$tmax[i]) + temp_corn(x$tmin[i]))/2) - 10)),2)
}else{
break
}
}
}
x <- x %>% mutate(stage = case_when(degree_day < 100 ~ "-",
degree_day < 346 ~ "VE",
degree_day < 592 ~ "V3",
degree_day < 838 ~ "V6",
degree_day < 1020 ~ "V9",
degree_day < 1170 ~ "V12",
degree_day < 1370 ~ "V15",
degree_day < 1420 ~ "V19",
degree_day < 1686 ~ "VT",
degree_day < 1830 ~ "R2",
degree_day < 1981 ~ "R3",
degree_day < 2324 ~ "R4",
degree_day < 2650 ~ "R5",
TRUE ~ "R6"))
return(x)
}
test <-bh_2024_2025 %>%
select(date,tmax,tmin) %>%
corn_degree_day(planting_date = "2024-10-01",2650)
kc_values_110 <- data.frame( DAE = 1:110,
kc = c(rep(0.5, 30),
rep(0.58558, 5),
rep(0.67618, 5),
rep(0.7684, 5),
rep(0.85889, 5),
rep(0.94371, 5),
rep(1.01841, 5),
rep(1.07819, 5),
rep(1.11775, 5),
rep(1.12898, 5),
rep(1.10472, 5),
rep(1.05639, 5),
rep(0.99005, 5),
rep(0.91074, 5),
rep(0.82314, 5),
rep(0.73152, 5),
rep(0.63958, 5)
)
View(kc_values_110)
View(kc_values_110)
source("water_balance_funtions.R")
source("kc_soybean.R")
bh_2024_2025 <-balanco_hidrico(-24.136102,-51.587440,"2024-01-01","2025-03-31",70)
bh_2024_2025
bh_soja<-balanco_hidrico_soja(bh_2024_2025,ciclo = 120,dia_da_emergencia = "2024-10-01" )
bh_soja
g_exc_def(bh_2024_2025)
g_rain_etp_etr(bh_2024_2025,"sequencial")
g_cad_arm(bh_2024_2025)
g_exc_def(bh_soja)
g_rain_etp_etr(bh_soja,"cultura")
g_cad_arm(bh_soja)
kc_values_110 <- data.frame( DAE = 1:110,
kc = c(rep(0.5, 30),
rep(0.58558, 5),
rep(0.67618, 5),
rep(0.7684, 5),
rep(0.85889, 5),
rep(0.94371, 5),
rep(1.01841, 5),
rep(1.07819, 5),
rep(1.11775, 5),
rep(1.12898, 5),
rep(1.10472, 5),
rep(1.05639, 5),
rep(0.99005, 5),
rep(0.91074, 5),
rep(0.82314, 5),
rep(0.73152, 5),
rep(0.63958, 5)
)
View(kc_values_110)
source("~/R_Scripts/Scripts/R-Water_Balance/kc_soybean.R")
View(kc_values_110)
bh_2024_2025 <-balanco_hidrico(-24.136102,-51.587440,"2024-01-01","2025-03-31",50)
source("water_balance_funtions.R")
source("kc_soybean.R")
bh_2024_2025 <-balanco_hidrico(-24.136102,-51.587440,"2024-01-01","2025-03-31",50)
bh_2024_2025
bh_soja<-balanco_hidrico_soja(bh_2024_2025,ciclo = 120,dia_da_emergencia = "2024-10-01" )
bh_soja
g_exc_def(bh_2024_2025)
g_rain_etp_etr(bh_2024_2025,"sequencial")
g_cad_arm(bh_2024_2025)
g_exc_def(bh_soja)
g_rain_etp_etr(bh_soja,"cultura")
g_cad_arm(bh_soja)
df <- data.frame()
df <- data.frame()
## Livrarias / Pacotes ##
library(tidyverse)
## Criação da função para calculo do BH diário ##
balanco_hidrico <- function(path_to_city_list,data_inicio,data_final,cad){
df_cidades <- read.csv(path_to_city_list)
df <- data.frame()
for (i in 1:nrow(df_cidades)){
dados_climaticos <- get_power(
pars = c("T2M","T2M_MAX","T2M_MIN","PRECTOTCORR"),
community = "AG",
temporal_api = "daily",
lonlat = c(lon,lat),
dates = c(data_inicio,data_final))  %>%
rename(
date = YYYYMMDD,
latitude = LAT,
longitude = LON,
tmean = T2M, # TEMPERATURA MÉDIA
tmax = T2M_MAX, # TEMPERATURA MÁXIMA
tmin = T2M_MIN, # TEMPERATURA MÍNIMA
rain = PRECTOTCORR, # PRECIPITAÇÃO
) %>%
mutate(
lat_rad = latitude*0.0174533,
dr = 1 + 0.033*cos((2*pi/365)*DOY),
Sd = 0.409*sin((2*pi/365)*DOY - 1.39),
ws = acos(-tan(lat_rad)*tan(Sd)),
Ra = (24*60)/(pi) * 0.0820 * dr * (ws*sin(lat_rad)*sin(Sd)+ cos(lat_rad)*sin(ws)),
etp = 0.0135 * 0.17  * (Ra / 2.45) * (sqrt(tmax-tmin)) * (tmean + 17.8),
p_etp = (rain - etp)) %>%
select(-c(dr, Sd, ws, Ra,lat_rad))
for (i in 1:nrow(dados_climaticos)) { ##For loop para calcular a ETP
if (i == 1){
if (dados_climaticos$p_etp[i] < 0) {
dados_climaticos$nac[i] <- (dados_climaticos$p_etp[i])
dados_climaticos$arm[i] <- cad * exp((dados_climaticos$nac[i]) / cad)
}
if (dados_climaticos$p_etp[i] >= 0){
dados_climaticos$arm[i] <- cad + dados_climaticos$p_etp[i]
dados_climaticos$nac[i] <- cad * log(dados_climaticos$arm[i] / cad)
}
}
if (i != 1){
if (dados_climaticos$p_etp[i] < 0) {
dados_climaticos$nac[i] <- (dados_climaticos$p_etp[i] + dados_climaticos$nac[i-1])
dados_climaticos$arm[i] <- cad * exp((dados_climaticos$nac[i]) / cad)
}
if (dados_climaticos$p_etp[i] >= 0){
dados_climaticos$arm[i] <- dados_climaticos$arm[i-1] + dados_climaticos$p_etp[i]
dados_climaticos$nac[i] <- cad * log(dados_climaticos$arm[i] / cad)
}
}
if (dados_climaticos$nac[i] >= 0){
dados_climaticos$nac[i] <- 0
}
if (dados_climaticos$arm[i] > cad){
dados_climaticos$arm[i] <- cad
}
}
df <- bind_rows(df,dados_climaticos)
}
return(df %>%
mutate(cad = cad,
alt = c(0, diff(arm)),
etr = case_when(p_etp < 0 ~ rain + abs(alt),
p_etp >= 0 ~ etp),
def = etp - etr,
exc = case_when(arm < cad ~ 0,
arm == cad ~ p_etp - alt)
)
)
}
source("water_balance_funtions.R")
source("kc_soybean.R")
bh_2024_2025 <-balanco_hidrico(-24.136102,-51.587440,"2024-01-01","2025-03-31",50)
bh_2024_2025
source("water_balance_funtions.R")
source("kc_soybean.R")
bh_2024_2025 <-balanco_hidrico(-24.136102,-51.587440,"2024-01-01","2025-03-31",50)
bh_2024_2025 <-balanco_hidrico("cidades.csv","2024-01-01","2025-03-31",50)
bh_2024_2025 <-balanco_hidrico("cidades.csv","2024-01-01","2025-03-31",50)
source("water_balance_funtions.R")
source("kc_soybean.R")
bh_2024_2025 <-balanco_hidrico("cidades.csv","2024-01-01","2025-03-31",50)
bh_2024_2025
bh_2024_2025 %>% distinct(longitude)
bh_2024_2025 %>% distinct(longitude,latitude)
bh_2024_2025
source("water_balance_funtions.R")
source("kc_soybean.R")
bh_2024_2025 <-balanco_hidrico("cidades.csv","2024-01-01","2025-03-31",50)
bh_2024_2025
bh_2024_2025 %>% distinct(cidade)
bh_2024_2025
bh_soja<-balanco_hidrico_soja(bh_2024_2025,ciclo = 120,dia_da_emergencia = "2024-10-01" )
bh_soja
bh_2024_2025 %>% distinct(cidade)
bh_soja %>% group_by(cidade) %>% split()
bh_soja %>% group_split(cidade)
bh_soja
source("water_balance_funtions.R")
source("kc_soybean.R")
bh_soja<-balanco_hidrico_soja(bh_2024_2025,ciclo = 120,dia_da_emergencia = "2024-10-01" )
bh_soja
bh_soja<-balanco_hidrico_soja(bh_2024_2025,ciclo = 120,dia_da_emergencia = "2024-10-01" )
bh_soja
source("water_balance_funtions.R")
source("kc_soybean.R")
bh_soja<-balanco_hidrico_soja(bh_2024_2025,ciclo = 120,dia_da_emergencia = "2024-10-01" )
bh_soja
source("water_balance_funtions.R")
source("kc_soybean.R")
bh_soja<-balanco_hidrico_soja(bh_2024_2025,ciclo = 120,dia_da_emergencia = "2024-10-01" )
source("water_balance_funtions.R")
source("kc_soybean.R")
source("water_balance_funtions.R")
source("kc_soybean.R")
bh_soja<-balanco_hidrico_soja(bh_2024_2025,ciclo = 120,dia_da_emergencia = "2024-10-01" )
source("water_balance_funtions.R")
source("kc_soybean.R")
bh_soja<-balanco_hidrico_soja(bh_2024_2025,ciclo = 120,dia_da_emergencia = "2024-10-01" )
bh_soja
source("water_balance_funtions.R")
source("kc_soybean.R")
g_exc_def(bh_soja)
bh_soja %>% group_split(cidade)
bh_soja %>% group_split(cidade) %>% select(cidade,etc:exc)
bh_soja %>% select(cidade,etc:exc)%>% group_split(cidade)
source("water_balance_funtions.R")
source("kc_soybean.R")
bh_soja<-balanco_hidrico_soja(bh_2024_2025,ciclo = 120,dia_da_emergencia = "2024-10-01" )
bh_soja
source("water_balance_funtions.R")
source("kc_soybean.R")
bh_soja<-balanco_hidrico_soja(bh_2024_2025,ciclo = 120,dia_da_emergencia = "2024-10-01" )
bh_soja
g_exc_def(bh_2024_2025)
g_rain_etp_etr(bh_2024_2025,"sequencial")
g_cad_arm(bh_2024_2025)
source("water_balance_funtions.R")
source("kc_soybean.R")
bh_2024_2025 <-balanco_hidrico("cidades.csv","2024-01-01","2025-03-31",50)
bh_2024_2025 <-balanco_hidrico("cidades.csv","2024-01-01","2025-03-31",50)
source("water_balance_funtions.R")
source("kc_soybean.R")
bh_2024_2025 <-balanco_hidrico("cidades.csv","2024-01-01","2025-03-31",50)
bh_2024_2025 <-balanco_hidrico(0,0,"2024-01-01","2025-03-31",50)
source("water_balance_funtions.R")
source("kc_soybean.R")
bh_2024_2025 <-balanco_hidrico(-24.136102,-51.587440,"2024-01-01","2025-03-31",50)
bh_2024_2025 <-balanco_hidrico(-24.136102,-51.587440,"2024-01-01","2024-03-31",50)
bh_2024_2025
source("water_balance_funtions.R")
source("kc_soybean.R")
bh_2024_2025 <-balanco_hidrico("cidades.csv","2024-01-01","2024-03-31",50)
bh_2024_2025 <-balanco_hidrico("cidades.csv","2024-01-01","2024-01-03",50)
bh_2024_2025 <-balanco_hidrico("cidades.csv","2024-01-01","2024-01-01",50)
source("water_balance_funtions.R")
source("kc_soybean.R")
source("water_balance_funtions.R")
source("kc_soybean.R")
bh_2024_2025 <-balanco_hidrico("cidades.csv","2024-01-01","2024-01-01",50)
bh_2024_2025
bh_2024_2025 <-balanco_hidrico("cidades.csv","2024-01-01","2024-30-01",50)
bh_2024_2025 <-balanco_hidrico("cidades.csv","2024-01-01","2024-01-30",50)
bh_2024_2025
bh_2024_2025 <-balanco_hidrico("cidades.csv","2024-01-01","2025-03-28",50)
bh_2024_2025
source("water_balance_funtions.R")
source("kc_soybean.R")
bh_soja<-balanco_hidrico_soja(bh_2024_2025,ciclo = 120,dia_da_emergencia = "2024-10-01" )
bh_soja<-balanco_hidrico_soja("cidades.csv",bh_2024_2025,ciclo = 120,dia_da_emergencia = "2024-10-01" )
bh_soja
bh_soja
bh_soja<-balanco_hidrico_soja("cidades.csv",bh_2024_2025,ciclo = 120,dia_da_emergencia = "2024-10-01" )
bh_soja
source("water_balance_funtions.R")
source("kc_soybean.R")
bh_soja<-balanco_hidrico_soja("cidades.csv",bh_2024_2025,ciclo = 120,dia_da_emergencia = "2024-10-01" )
bh_soja
bh_soja
source("water_balance_funtions.R")
source("kc_soybean.R")
bh_soja<-balanco_hidrico_soja("cidades.csv",bh_2024_2025,ciclo = 120,dia_da_emergencia = "2024-10-01" )
bh_soja
source("water_balance_funtions.R")
source("kc_soybean.R")
g_exc_def(bh_soja)
bh_soja %>% group_split(cidade)
source("water_balance_funtions.R")
source("kc_soybean.R")
g_exc_def(bh_soja)
g_rain_etp_etr(bh_soja,"cultura")
g_cad_arm(bh_soja)
source("water_balance_funtions.R")
source("kc_soybean.R")
g_exc_def(bh_2024_2025)
g_rain_etp_etr(bh_2024_2025,"sequencial")
g_cad_arm(bh_2024_2025)
