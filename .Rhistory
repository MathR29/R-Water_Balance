}
if (df_balanco_hidrico$p_etc[i] >= 0){
df_balanco_hidrico$arm[i] <- df_balanco_hidrico$cad[i] + df_balanco_hidrico$p_etc[i]
df_balanco_hidrico$nac[i] <- df_balanco_hidrico$cad[i] * log(df_balanco_hidrico$arm[i] / df_balanco_hidrico$cad[i])
}
}
if (i != 1){
if (df_balanco_hidrico$p_etc[i] < 0) {
df_balanco_hidrico$nac[i] <- (df_balanco_hidrico$p_etc[i] + df_balanco_hidrico$nac[i-1])
df_balanco_hidrico$arm[i] <- df_balanco_hidrico$cad[i] * exp((df_balanco_hidrico$nac[i]) / df_balanco_hidrico$cad[i])
}
if (df_balanco_hidrico$p_etc[i] >= 0){
df_balanco_hidrico$arm[i] <- df_balanco_hidrico$arm[i-1] + df_balanco_hidrico$p_etc[i]
df_balanco_hidrico$nac[i] <- df_balanco_hidrico$cad[i] * log(df_balanco_hidrico$arm[i] / df_balanco_hidrico$cad[i])
}
}
if (df_balanco_hidrico$nac[i] >= 0){
df_balanco_hidrico$nac[i] <- 0
}
if (df_balanco_hidrico$arm[i] > df_balanco_hidrico$cad[i]){
df_balanco_hidrico$arm[i] <- df_balanco_hidrico$cad[i]
}
}
return(df_balanco_hidrico %>%
mutate(cad = df_balanco_hidrico$cad[i],
alt = c(0, diff(arm)),
etr = case_when(p_etc < 0 ~ rain + abs(alt),
p_etc >= 0 ~ etc),
def = etc - etr,
exc = case_when(arm < df_balanco_hidrico$cad[i] ~ 0,
arm == df_balanco_hidrico$cad[i] ~ p_etc - alt),
`etr/etc` = etr/etc)))
balanco_hidrico_soja <- function(df_balanco_hidrico,dia_da_emergencia,ciclo){
if (ciclo == 110){
for (i in 1:nrow(df_balanco_hidrico)) {
df_balanco_hidrico$DAE[i] <- case_when(
df_balanco_hidrico$date[i] < as.Date(dia_da_emergencia) ~ NA,
df_balanco_hidrico$date[i] >= as.Date(dia_da_emergencia) & df_balanco_hidrico$date[i] < (as.Date(dia_da_emergencia)+110) ~
as.numeric(df_balanco_hidrico$date[i] - as.Date(dia_da_emergencia)) + 1)
}
df_balanco_hidrico <- df_balanco_hidrico %>%
inner_join(kc_values_110)
}
if (ciclo == 120){
for (i in 1:nrow(df_balanco_hidrico)) {
df_balanco_hidrico$DAE[i] <- case_when(
df_balanco_hidrico$date[i] < as.Date(dia_da_emergencia) ~ NA,
df_balanco_hidrico$date[i] >= as.Date(dia_da_emergencia) & df_balanco_hidrico$date[i] < (as.Date(dia_da_emergencia)+120) ~
as.numeric(df_balanco_hidrico$date[i] - as.Date(dia_da_emergencia)) + 1)
}
df_balanco_hidrico <- df_balanco_hidrico %>%
inner_join(kc_values_120)
}
if (ciclo == 130){
for (i in 1:nrow(df_balanco_hidrico)) {
df_balanco_hidrico$DAE[i] <- case_when(
df_balanco_hidrico$date[i] < as.Date(dia_da_emergencia) ~ NA,
df_balanco_hidrico$date[i] >= as.Date(dia_da_emergencia) & df_balanco_hidrico$date[i] < (as.Date(dia_da_emergencia)+130) ~
as.numeric(df_balanco_hidrico$date[i] - as.Date(dia_da_emergencia)) + 1)
}
df_balanco_hidrico <- df_balanco_hidrico %>%
inner_join(kc_values_130)
}
df_balanco_hidrico <- df_balanco_hidrico%>%
mutate(etc = etp * kc,
p_etc = rain - etc) %>%
select(-c(arm,nac,def,etr,exc,alt,p_etp))
for (i in 1:nrow(df_balanco_hidrico)) { ##For loop para calcular a ETC
if (i == 1){
if (df_balanco_hidrico$p_etc[i] < 0) {
df_balanco_hidrico$nac[i] <- (df_balanco_hidrico$p_etc[i])
df_balanco_hidrico$arm[i] <- df_balanco_hidrico$cad[i] * exp((df_balanco_hidrico$nac[i]) / df_balanco_hidrico$cad[i])
}
if (df_balanco_hidrico$p_etc[i] >= 0){
df_balanco_hidrico$arm[i] <- df_balanco_hidrico$cad[i] + df_balanco_hidrico$p_etc[i]
df_balanco_hidrico$nac[i] <- df_balanco_hidrico$cad[i] * log(df_balanco_hidrico$arm[i] / df_balanco_hidrico$cad[i])
}
}
if (i != 1){
if (df_balanco_hidrico$p_etc[i] < 0) {
df_balanco_hidrico$nac[i] <- (df_balanco_hidrico$p_etc[i] + df_balanco_hidrico$nac[i-1])
df_balanco_hidrico$arm[i] <- df_balanco_hidrico$cad[i] * exp((df_balanco_hidrico$nac[i]) / df_balanco_hidrico$cad[i])
}
if (df_balanco_hidrico$p_etc[i] >= 0){
df_balanco_hidrico$arm[i] <- df_balanco_hidrico$arm[i-1] + df_balanco_hidrico$p_etc[i]
df_balanco_hidrico$nac[i] <- df_balanco_hidrico$cad[i] * log(df_balanco_hidrico$arm[i] / df_balanco_hidrico$cad[i])
}
}
if (df_balanco_hidrico$nac[i] >= 0){
df_balanco_hidrico$nac[i] <- 0
}
if (df_balanco_hidrico$arm[i] > df_balanco_hidrico$cad[i]){
df_balanco_hidrico$arm[i] <- df_balanco_hidrico$cad[i]
}
}
return(df_balanco_hidrico %>%
mutate(cad = df_balanco_hidrico$cad[i],
alt = c(0, diff(arm)),
etr = case_when(p_etc < 0 ~ rain + abs(alt),
p_etc >= 0 ~ etc),
def = etc - etr,
exc = case_when(arm < df_balanco_hidrico$cad[i] ~ 0,
arm == df_balanco_hidrico$cad[i] ~ p_etc - alt),
`etr/etc` = etr/etc))
}
bh_soja<-balanco_hidrico_soja(bh_2024_2025,ciclo = 120,dia_da_emergencia = "2024-10-01" )
bh_soja
bh_soja<-balanco_hidrico_soja(bh_2024_2025,ciclo = 110,dia_da_emergencia = "2024-10-01" )
bh_soja
bh_soja<-balanco_hidrico_soja(bh_2024_2025,ciclo = 130,dia_da_emergencia = "2024-10-01" )
bh_soja
g_exc_def(bh_2024_2025)
g_rain_etp_etr(bh_2024_2025,"sequencial")
g_cad_arm(bh_2024_2025)
g_exc_def(bh_soja)
g_rain_etp_etr(bh_soja,"cultura")
g_cad_arm(bh_soja)
source("water_balance_funtions.R")
source("kc_soybean.R")
bh_2024_2025 <-balanco_hidrico(-24.136102,-51.587440,"2024-01-01","2025-03-31",90)
bh_2024_2025
source("water_balance_funtions.R")
source("kc_soybean.R")
bh_2024_2025 <-balanco_hidrico(-24.136102,-51.587440,"2024-01-01","2025-03-31",90)
bh_2024_2025
bh_soja<-balanco_hidrico_soja(bh_2024_2025,ciclo = 130,dia_da_emergencia = "2024-10-01" )
bh_soja
g_exc_def(bh_2024_2025)
g_rain_etp_etr(bh_2024_2025,"sequencial")
g_cad_arm(bh_2024_2025)
g_exc_def(bh_soja)
g_rain_etp_etr(bh_soja,"cultura")
g_cad_arm(bh_soja)
bh_soja<-balanco_hidrico_soja(bh_2024_2025,ciclo = 120,dia_da_emergencia = "2024-10-01" )
bh_soja
bh_2024_2025 <-balanco_hidrico(-24.136102,-51.587440,"2024-01-01","2025-03-31",50)
bh_2024_2025
bh_soja<-balanco_hidrico_soja(bh_2024_2025,ciclo = 120,dia_da_emergencia = "2024-10-01" )
bh_soja
g_exc_def(bh_soja)
g_rain_etp_etr(bh_soja,"cultura")
g_cad_arm(bh_soja)
cumsum
corn_degree_day(c(1:40),1,2)
source("~/.active-rstudio-document")
source("~/.active-rstudio-document")
corn_degree_day <- funtion (x,basal_tmax,basal_tmin){
source("~/.active-rstudio-document")
source("~/.active-rstudio-document")
corn_degree_day <- function(x,basal_tmax,basal_tmin){
for i in c(1:length(x)){
greater_then_30<- function(number){
if(number >= 30){
return(30)
}
ifelse(number < 30){
if(number >= 30){
return(30)
}ifelse(number < 30){
greater_then_30<- function(number){
if(number >= 30){
return(30)
}ifelse(number < 30){
greater_then_30<- function(number){
if(number >= 30){
return(30)
}
}
greater_then_30<- function(number){
if(number >= 30){
return(30)
}
ifelse(number < 30){
greater_then_30<- function(number){
if(number >= 30){
return(30)
}
if(number < 30){
return(number)
}
}
print(greater_then_30(2))
print(greater_then_30(30))
print(greater_then_30(31))
print(greater_then_30(1111))
greater_then_30<- function(number){
if(number >= 30){
return(30)
}
if(number < 30 & number >= 0){
return(number)
}
}
print(greater_then_30(-2))
greater_then_30<- function(number){
if(number >= 30){
return(30)
}
if(number < 30 & number >= 0){
return(number)
}else{
return(0)
}
}
print(greater_then_30(-2))
print(greater_then_30(10))
print(greater_then_30(10.00000000000001))
if(number < 30 & number >= 10){
return(number)
}else{
return(0)
}
greater_then_30<- function(number){
if(number >= 30){
return(30)
}
if(number < 30 & number >= 10){
return(number)
}else{
return(0)
}
}
print(greater_then_30(10.00000000000001))
print(greater_then_30(9.99))
temp_corn <- function(number) {
if (number >= 30) {
30
} else if (number >= 10) {
number
} else {
10
}
}
print(greater_then_30(9.99))
print(temp_corn(9.99))
print(temp_corn(-5))
corn_degree_day <- function(x,basal_tmax,basal_tmin){
for (i in 1:length(x)){
x$degree_day[i] <-(
((temp_corn(x$tmax) + temp_corn(x$tmin))/2) - 10
)
}
}
corn_degree_day <- function(x,basal_tmax,basal_tmin){
dg <- 0
for (i in 1:length(x)){
y <- (((temp_corn(x$tmax[i]) + temp_corn(x$tmin[i]))/2) - 10)
x$degree_day[i] <- y + dg
dg <- x$degree_day[i]
}
}
source("water_balance_funtions.R")
source("kc_soybean.R")
bh_2024_2025 <-balanco_hidrico(-24.136102,-51.587440,"2024-01-01","2025-03-31",50)
bh_2024_2025
corn_degree_day <- function(x){
dg <- 0
for (i in 1:length(x)){
y <- (((temp_corn(x$tmax[i]) + temp_corn(x$tmin[i]))/2) - 10)
x$degree_day[i] <- y + dg
dg <- x$degree_day[i]
}
}
bh_2024_2025 %>% corn_degree_day()
bh_2024_2025 %>% corn_degree_day()
le <- bh_2024_2025 %>% corn_degree_day()
corn_degree_day <- function(x){
dg <- 0
for (i in 1:length(x)){
y <- (((temp_corn(x$tmax[i]) + temp_corn(x$tmin[i]))/2) - 10)
x$degree_day[i] <- y + dg
dg <- x$degree_day[i]
}
return(x)
}
le <- bh_2024_2025 %>% corn_degree_day()
le
le <- bh_2024_2025 %>% corn_degree_day() %>%  select(date,tmax,tmin,degree_day)
le <- bh_2024_2025 %>% corn_degree_day() %>%  select(date,tmax,tmin,degree_day)
le
corn_degree_day <- function(x){
for (i in 1:length(x)){
if(i == 1){
x$degree_day[i] <- (((temp_corn(x$tmax[i]) + temp_corn(x$tmin[i]))/2) - 10)
}else{
x$degree_day[i] <- (((temp_corn(x$tmax[i]) + temp_corn(x$tmin[i]))/2) - 10) + x$degree_day[i-1]
}
}
return(x)
}
bh_2024_2025 %>% select(date,tmax,tmin) %>% corn_degree_day()
corn_degree_day <- function(x){
for (i in 1:nrow(x)){
if(i == 1){
x$degree_day[i] <- (((temp_corn(x$tmax[i]) + temp_corn(x$tmin[i]))/2) - 10)
}else{
x$degree_day[i] <- (((temp_corn(x$tmax[i]) + temp_corn(x$tmin[i]))/2) - 10) + x$degree_day[i-1]
}
}
return(x)
}
bh_2024_2025 %>% select(date,tmax,tmin) %>% corn_degree_day()
test <- bh_2024_2025 %>% select(date,tmax,tmin) %>% corn_degree_day()
View(test)
corn_degree_day1 <- function(x){
temp_basal <- 10
tmin <- sapply(x$tmin,temp_corn)
tmax <- sapply(x$tmax,temp_corn)
x$degree_day <- cumsum(((tmax+tmin)/2)-temp_basal)
return(x)
}
test1 <-bh_2024_2025 %>% select(date,tmax,tmin) %>% corn_degree_day1()
View(test1)
source("water_balance_funtions.R")
source("kc_soybean.R")
bh_2024_2025 <-balanco_hidrico(-24.136102,-51.587440,"2024-01-01","2025-03-31",50)
bh_2024_2025
corn_degree_day <- function(x,max_gd,emerg_day){
for(i in 1:nrow(x)){
if(x$date[i] < as.Date(emerg_day)){
x$degree_day[i] <- 0
}else{
x$degree_day[i] <- (x$degree_day[i-1] + (((temp_corn(x$tmax[i]) + temp_corn(x$tmin[i]))/2) - 10))
}
}
return(x)
}
corn_degree_day <- function(x,max_gd,emerg_day){
for(i in 1:nrow(x)){
if(x$date[i] < as.Date(emerg_day)){
x$degree_day[i] <- 0
}else{
x$degree_day[i] <- (x$degree_day[i-1] + (((temp_corn(x$tmax[i]) + temp_corn(x$tmin[i]))/2) - 10))
}
}
return(x)
}
bh_2024_2025 %>% corn_degree_day()
bh_2024_2025 %>% corn_degree_day("2024-10-01")
bh_2024_2025 %>% corn_degree_day(emerg_day = "2024-10-01")
temp_corn <- function(number) {
if (number >= 30) {
return(30)
} else if (number >= 10) {
return(number)
} else {
return(10)
}
}
bh_2024_2025 %>% corn_degree_day(emerg_day = "2024-10-01")
corn_degree_day <- function(x,max_gd,emerg_day){
for(i in 1:nrow(x)){
if(x$date[i] < as.Date(emerg_day)){
x$degree_day[i] <- 0
}else{
if(degree_day[i-1] < max_dg ){
x$degree_day[i] <- (x$degree_day[i-1] + (((temp_corn(x$tmax[i]) + temp_corn(x$tmin[i]))/2) - 10))
}else{
break
}
}
}
return(x)
}
corn_degree_day <- function(x,max_gd,emerg_day){
for(i in 1:nrow(x)){
if(x$date[i] < as.Date(emerg_day)){
x$degree_day[i] <- 0
}else{
if(degree_day[i-1] < max_dg ){
x$degree_day[i] <- (x$degree_day[i-1] + (((temp_corn(x$tmax[i]) + temp_corn(x$tmin[i]))/2) - 10))
}else{
break
}
}
}
return(x)
}
bh_2024_2025() %>%
select(date,tmax,tmin) %>%
corn_degree_day(emerg_day = "2024-10-01",2400)
bh_2024_2025 %>%
select(date,tmax,tmin) %>%
corn_degree_day(emerg_day = "2024-10-01",2400)
corn_degree_day <- function(x,max_gd,emerg_day){
for(i in 1:nrow(x)){
if(x$date[i] < as.Date(emerg_day)){
x$degree_day[i] <- 0
}else{
if(x$degree_day[i-1] < max_dg ){
x$degree_day[i] <- (x$degree_day[i-1] + (((temp_corn(x$tmax[i]) + temp_corn(x$tmin[i]))/2) - 10))
}else{
break
}
}
}
return(x)
}
bh_2024_2025 %>%
select(date,tmax,tmin) %>%
corn_degree_day(emerg_day = "2024-10-01",2400)
corn_degree_day <- function(x,max_gd,emerg_day){
for(i in 1:nrow(x)){
if(x$date[i] < as.Date(emerg_day)){
x$degree_day[i] <- 0
}else{
if(x$degree_day[i-1] < max_gd ){
x$degree_day[i] <- (x$degree_day[i-1] + (((temp_corn(x$tmax[i]) + temp_corn(x$tmin[i]))/2) - 10))
}else{
break
}
}
}
return(x)
}
bh_2024_2025 %>%
select(date,tmax,tmin) %>%
corn_degree_day(emerg_day = "2024-10-01",2400)
test <- bh_2024_2025 %>%
select(date,tmax,tmin) %>%
corn_degree_day(emerg_day = "2024-10-01",2400)
View(test)
corn_degree_day <- function(x,max_gd,emerg_day){
for(i in 1:nrow(x)){
if(x$date[i] < as.Date(emerg_day)){
x$degree_day[i] <- 0
}else{
if(x$degree_day[i-1] < max_gd ){
x$degree_day[i] <- (x$degree_day[i-1] + (((temp_corn(x$tmax[i]) + temp_corn(x$tmin[i]))/2) - 10))
}else{
x$degree_day[i] <- 0
}
}
}
return(x)
}
test <- bh_2024_2025 %>%
select(date,tmax,tmin) %>%
corn_degree_day(emerg_day = "2024-10-01",2400)
test <-bh_2024_2025 %>%
select(date,tmax,tmin) %>%
corn_degree_day(emerg_day = "2024-10-01",2400)
corn_degree_day <- function(x,max_gd,emerg_day){
for(i in 1:nrow(x)){
if(x$date[i] < as.Date(emerg_day)){
x$degree_day[i] <- 0
}else{
if(x$degree_day[i-1] < max_gd ){
x$degree_day[i] <- (x$degree_day[i-1] + (((temp_corn(x$tmax[i]) + temp_corn(x$tmin[i]))/2) - 10))
}else{
break
}
}
}
return(x)
}
test <-bh_2024_2025 %>%
select(date,tmax,tmin) %>%
corn_degree_day(emerg_day = "2024-10-01",2400)
corn_degree_day <- function(x,max_gd,emerg_day){
for(i in 1:nrow(x)){
if(x$date[i] < as.Date(emerg_day)){
x$degree_day[i] <- 0.00
}else{
if(x$degree_day[i-1] < max_gd ){
x$degree_day[i] <- round((x$degree_day[i-1] + (((temp_corn(x$tmax[i]) + temp_corn(x$tmin[i]))/2) - 10)),2)
}else{
break
}
}
}
return(x)
}
test <-bh_2024_2025 %>%
select(date,tmax,tmin) %>%
corn_degree_day(emerg_day = "2024-10-01",2400)
corn_degree_day <- function(x,max_gd,emerg_day){
for(i in 1:nrow(x)){
if(x$date[i] < as.Date(emerg_day)){
x$degree_day[i] <- as.numeric(0.00)
}else{
if(x$degree_day[i-1] < max_gd ){
x$degree_day[i] <- round((x$degree_day[i-1] + (((temp_corn(x$tmax[i]) + temp_corn(x$tmin[i]))/2) - 10)),2)
}else{
break
}
}
}
return(x)
}
test <-bh_2024_2025 %>%
select(date,tmax,tmin) %>%
corn_degree_day(emerg_day = "2024-10-01",2400)
corn_degree_day <- function(x,max_gd,emerg_day){
x$dregree_day <- NA
for(i in 1:nrow(x)){
if(x$date[i] < as.Date(emerg_day)){
x$degree_day[i] <- as.numeric(0.00)
}else{
if(x$degree_day[i-1] < max_gd ){
x$degree_day[i] <- round((x$degree_day[i-1] + (((temp_corn(x$tmax[i]) + temp_corn(x$tmin[i]))/2) - 10)),2)
}else{
break
}
}
}
return(x)
}
test <-bh_2024_2025 %>%
select(date,tmax,tmin) %>%
corn_degree_day(emerg_day = "2024-10-01",2400)
View(test)
